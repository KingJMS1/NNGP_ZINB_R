[{"path":"https://kingjms1.github.io/NNGP_ZINB_R/articles/simulated_data.html","id":"using-zinb-gps-zinb_nngp-model","dir":"Articles","previous_headings":"","what":"Using ZINB.GP’s ZINB_NNGP model","title":"A Simple Simulation","text":"First, import package well dependencies use simulate dataset.","code":"library(mvtnorm) library(Matrix) library(ZINB.GP)"},{"path":"https://kingjms1.github.io/NNGP_ZINB_R/articles/simulated_data.html","id":"generating-a-dataset","dir":"Articles","previous_headings":"Using ZINB.GP’s ZINB_NNGP model","what":"Generating a dataset","title":"A Simple Simulation","text":"go full process generate dataset attempt provide clarity various matrix parameters passed ZINB_NNGP .","code":""},{"path":"https://kingjms1.github.io/NNGP_ZINB_R/articles/simulated_data.html","id":"helper-functions","dir":"Articles","previous_headings":"Using ZINB.GP’s ZINB_NNGP model > Generating a dataset","what":"Helper functions","title":"A Simple Simulation","text":"First define helper functions. first create Vs Vt, spatial temporal design matrices. consit indicator variables indicating point space/time data points . Next, make functions generate spatial temporal random effects (varying intercepts) corresponding distance matrices.","code":"make_Vs_Vt <- function(num_spatial, num_temporal, avg_obs) {     n_time_points <- num_temporal # Number of temporal units     n_unit_mat <- matrix(rpois(num_spatial * n_time_points, avg_obs), nrow = num_spatial, byrow = TRUE) # sample around avg_obs observations per sampling unit (both space and time)      N <- sum(n_unit_mat)    # Total number of observations     id <- c()     for (i in seq_len(nrow(n_unit_mat))) {         id <- c(id, rep(i, sum(n_unit_mat[i, ])))     }      tp_seq <- c()     for (j in seq_len(ncol(n_unit_mat))) {         tp_seq <- c(tp_seq, rep(j, sum(n_unit_mat[, j])))     }      # spatial design matrix     Vs <- as.matrix(sparseMatrix(i = 1:N, j = id, x = rep(1, N)))      # temporal design matrix     Vt <- as.matrix(sparseMatrix(i = 1:N, j = tp_seq, x = rep(1, N)))      return(list(Vs = Vs, Vt = Vt, N = N)) } make_spatial_effects <- function(phi_nb, phi_bin, sigma_bin_s, sigma_nb_s, coords) {     ##########################     # Spatial Random Effects #     ##########################     Ds <- as.matrix(dist(coords))     Ks_bin <- sigma_bin_s^2 * exp(-phi_bin * Ds)     Ks_nb <- sigma_nb_s^2 * exp(-phi_nb * Ds)     a <- t(rmvnorm(n = 1, sigma = Ks_bin))     c <- t(rmvnorm(n = 1, sigma = Ks_nb))      return(list(a = a, c = c, Ds = Ds)) }  make_temporal_effects <- function(l1t, l2t, sigma1t, sigma2t, n_time_points) {     ###########################     # Temporal Random Effects #     ###########################     w <- matrix(1:n_time_points, ncol = 1)     Dt <- as.matrix(dist(w))          Kt_bin <- sigma1t^2 * exp(-Dt / (l1t^2))     Kt_nb <- sigma2t^2 * exp(-Dt / (l2t^2))          b <- t(rmvnorm(n = 1, sigma = Kt_bin))     d <- t(rmvnorm(n = 1, sigma = Kt_nb))          return(list(b = b, d = d, Dt = Dt)) }"},{"path":"https://kingjms1.github.io/NNGP_ZINB_R/articles/simulated_data.html","id":"actually-generating-the-data","dir":"Articles","previous_headings":"Using ZINB.GP’s ZINB_NNGP model > Generating a dataset","what":"Actually Generating the Data","title":"A Simple Simulation","text":"Now ready generate dataset. First define number spatial temporal points using. , create spatial temporal design matrices. , generate spatial coordinates, main predictors interest X. Next, create spatial temporal distance matrices, spatial temporal random effects. define fixed effects (coefficients X) logistic regression negative binomial models. , generate spatial temporal noise terms added mix Finally, can create models. First simulate whether risk group traditional logistic regression setting: , -risk group, draw value point negative binomial distribution, GLM setting logit link.","code":"num_spatial <- 30 num_temporal <- 10 # Get Spatial and temporal design matrices, and total number of observations out <- make_Vs_Vt(num_spatial, num_temporal, 2) Vs <- out$Vs Vt <- out$Vt N  <- out$N     # Total number of observations coords <- cbind(runif(num_spatial), runif(num_spatial)) x <- rnorm(N, 0, 1) X <- as.matrix(x) # Design matrix, can add additional covariates (e.g., race, age, gender) X <- cbind(1, X) p <- ncol(X) phi_nb <- 1 phi_bin <- 2        # Spatial Kernel length scale for Gaussian processes in the logistic regression and negative binomial parts of the model sigma_bin_s <- 1     sigma_nb_s <- 1     # Overall spatial kernel Scale for GPs out <- make_spatial_effects(phi_nb, phi_bin, sigma_bin_s, sigma_nb_s, coords) a <- out$a c <- out$c          # Spatial random effects Ds <- out$Ds        # Spatial Distance matrix  l1t <- 2 l2t <- 3            # Temporal Kernel length scale sigma1t <- 0.5 sigma2t <- 0.5      # Overall temporal kernel scale for GPs out <- make_temporal_effects(l1t, l2t, sigma1t, sigma2t, num_temporal) b <- out$b d <- out$d          # Temporal random effects Dt <- out$Dt        # Temporal distance matrix # LR Part alpha <- c(-0.25, 0.25)  # NB Part beta <- c(.5, -.25) sigma_eps1s <- sigma_eps2s <- 0.05 eps1s <- t(rmvnorm(n = 1, sigma = diag(sigma_eps1s^2, nrow = num_spatial))) eps2s <- t(rmvnorm(n = 1, sigma = diag(sigma_eps2s^2, nrow = num_spatial)))  sigma_eps1t <- sigma_eps2t <- 0.05 eps1t <- t(rmvnorm(n = 1, sigma = diag(sigma_eps1t^2, nrow = num_temporal))) eps2t <- t(rmvnorm(n = 1, sigma = diag(sigma_eps2t^2, nrow = num_temporal))) phi1 <- Vs %*% a + Vt %*% b eta1 <- X %*% alpha + phi1 + Vs %*% eps1s + Vt %*% eps1t  p_at_risk <- exp(eta1) / (1 + exp(eta1)) # 1-pr(\"structural zero\") u <- rbinom(N, 1, p_at_risk[, 1]) # at-risk indicator phi3 <- Vs %*% c + Vt %*% d eta2 <- X[u == 1, ] %*% beta + phi3[u == 1, ] + Vs[u == 1, ] %*% eps2s + Vt[u == 1, ] %*% eps2t # Linear predictor for count part N1 <- sum(u == 1)  r <- 1 # NB dispersion psi <- exp(eta2) / (1 + exp(eta2)) # Prob of success  mu <- r * psi / (1 - psi) # NB mean y <- rep(0, N) # Response y[u == 1] <- rnbinom(N1, r, mu = mu[, 1]) # If at risk, draw from NB"},{"path":"https://kingjms1.github.io/NNGP_ZINB_R/articles/simulated_data.html","id":"running-the-model-on-the-generated-dataset","dir":"Articles","previous_headings":"Using ZINB.GP’s ZINB_NNGP model","what":"Running the model on the generated dataset","title":"A Simple Simulation","text":"Now ready run model. done follows: can investigate output desired, example, create 90% CIs alpha beta, investigate often samples selected risk. Looking 90% CIs coefficients -risk LR model:  Looking 90% CIs coefficients NB model:  Viewing frequency samples risk:","code":"# Run for a short time for demo purposes output <- ZINB_NNGP(X, y, coords, Vs, Vt, Ds, Dt, M = 10, 200, 100, 1, TRUE) predictions <- output$Y_pred sim_alpha <- output$Alpha sim_beta <- output$Beta alpha #> [1] -0.25  0.25 aCIs <- apply(sim_alpha, 2, function(x) quantile(x, probs=c(0.05, 0.95))) boxplot(aCIs, main = \"CIs for Alpha\") beta #> [1]  0.50 -0.25 bCIs <- apply(sim_beta, 2, function(x) quantile(x, probs=c(0.05, 0.95))) boxplot(bCIs, main = \"CIs for Beta\") # Examine how often various samples are at risk at_risk <- output$at_risk sim_p_at_risk <- apply(at_risk, 2, mean) sim_p_at_risk[1:20] #>  [1] 0.37 0.22 0.14 1.00 0.71 0.93 1.00 0.92 0.80 0.83 0.84 0.48 0.34 1.00 0.90 #> [16] 0.56 0.60 1.00 0.96 1.00"},{"path":"https://kingjms1.github.io/NNGP_ZINB_R/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Qing . Author. Mahlon Scott. Author. Hsin-Hsiung Huang. Author, maintainer.","code":""},{"path":"https://kingjms1.github.io/NNGP_ZINB_R/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Q, Scott M, Huang H (2025). ZINB.GP: Zero Inflated Negative Binomial model Using Gaussian Processes. R package version 0.0.0.9000, https://kingjms1.github.io/NNGP_ZINB_R/.","code":"@Manual{,   title = {ZINB.GP: Zero Inflated Negative Binomial model Using Gaussian Processes},   author = {Qing He and Mahlon Scott and Hsin-Hsiung Huang},   year = {2025},   note = {R package version 0.0.0.9000},   url = {https://kingjms1.github.io/NNGP_ZINB_R/}, }"},{"path":"https://kingjms1.github.io/NNGP_ZINB_R/index.html","id":"zinb-nngp-bayesian-model","dir":"","previous_headings":"","what":"Zero Inflated Negative Binomial model Using Gaussian Processes","title":"Zero Inflated Negative Binomial model Using Gaussian Processes","text":"package implements model described “Framework Zero-Inflated Bayesian Negative Binomial Regression Models Spatiotemporal Data” Qing Hsin-Hsiung Huang (2023). https://doi.org/10.1016/j.jspi.2023.106098. package work progress, feel free create issue suggestions notice problems.","code":""},{"path":"https://kingjms1.github.io/NNGP_ZINB_R/index.html","id":"installation-instructions","dir":"","previous_headings":"","what":"Installation Instructions","title":"Zero Inflated Negative Binomial model Using Gaussian Processes","text":"Install devtools R package, run following command","code":"install.packages(c(\"BayesLogit\", \"FastGP\", \"LaplacesDemon\", \"MASS\", \"Matrix\", \"msm\", \"mvtnorm\", \"spNNGP\")) devtools::install_github(\"KingJMS1/NNGP_ZINB_R\")"},{"path":"https://kingjms1.github.io/NNGP_ZINB_R/index.html","id":"example-use","dir":"","previous_headings":"","what":"Example Use","title":"Zero Inflated Negative Binomial model Using Gaussian Processes","text":"Detailed examples full code can found vignettes folder, following link articles: https://kingjms1.github.io/NNGP_ZINB_R/ Given , predictions can found via:","code":"X       Other Predictor variables y       Zero inflated count response coords  Spatial coordinates for NNGP Vs      Spatially varying predictor variables         (e.g. one-hot indication of which location this is for varying intercept),         wrapped in sparseMatrix from Matrix R package.         Will be multiplied by the spatial random effects for prediction. Vt      Temporal varying predictor variables, wrapped in sparseMatrix from Matrix R package.         Will be multiplied by the temporal random effects for prediction. Ds      Spatial distance matrix, diagonal should be 0,         off diagonal is distance between elements i and j in space, inputs to the spatial NNGP kernel Dt      Temporal distance matirx, diagonal should be 0,         off diagonal is distance between elements i and j in time, inputs to the temporal GP kernel M       How many neighbors to allow in the spatial NNGP algorithm, defaults to 10. nsim    How long to run MCMC in total, must be greater than burn. burn    How long to run MCMC before saving samples. library(ZINB.GP) output <- ZINB_NNGP(X, y, coords, Vs, Vt, Ds, Dt, M = M, nsim, burn, save_ypred = TRUE) predictions <- output$Y_pred"},{"path":"https://kingjms1.github.io/NNGP_ZINB_R/index.html","id":"api-reference","dir":"","previous_headings":"","what":"API Reference","title":"Zero Inflated Negative Binomial model Using Gaussian Processes","text":"API reference: https://kingjms1.github.io/NNGP_ZINB_R/reference/index.html","code":""},{"path":"https://kingjms1.github.io/NNGP_ZINB_R/reference/NNMatrix.html","id":null,"dir":"Reference","previous_headings":"","what":"Create neighbord matrix with spNNGP — NNMatrix","title":"Create neighbord matrix with spNNGP — NNMatrix","text":"Create neighbord matrix spNNGP","code":""},{"path":"https://kingjms1.github.io/NNGP_ZINB_R/reference/NNMatrix.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Create neighbord matrix with spNNGP — NNMatrix","text":"","code":"NNMatrix(coords, n.neighbors, n.omp.threads = 2, search.type = \"brute\")"},{"path":"https://kingjms1.github.io/NNGP_ZINB_R/reference/ZINB_NNGP.html","id":null,"dir":"Reference","previous_headings":"","what":"Run the ZINB NNGP model described in https://doi.org/10.1016/j.jspi.2023.106098. — ZINB_NNGP","title":"Run the ZINB NNGP model described in https://doi.org/10.1016/j.jspi.2023.106098. — ZINB_NNGP","text":"Run ZINB NNGP model described https://doi.org/10.1016/j.jspi.2023.106098.","code":""},{"path":"https://kingjms1.github.io/NNGP_ZINB_R/reference/ZINB_NNGP.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Run the ZINB NNGP model described in https://doi.org/10.1016/j.jspi.2023.106098. — ZINB_NNGP","text":"","code":"ZINB_NNGP(   X,   y,   coords,   Vs,   Vt,   Ds,   Dt,   M = 10,   nsim,   burn,   thin = 1,   save_ypred = FALSE,   print_iter = 100,   print_progress = FALSE )"},{"path":"https://kingjms1.github.io/NNGP_ZINB_R/reference/ZINB_NNGP.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Run the ZINB NNGP model described in https://doi.org/10.1016/j.jspi.2023.106098. — ZINB_NNGP","text":"X Predictor variables y Zero inflated count response coords Spatial coordinates NNGP Vs Spatially varying predictor variables (e.g. one-hot indication location varying intercept), wrapped sparseMatrix Matrix R package. multiplied spatial random effects prediction. Vt Temporal varying predictor variables, wrapped sparseMatrix Matrix R package. multiplied temporal random effects prediction. Ds Spatial distance matrix, diagonal 0, diagonal distance elements j space, inputs spatial NNGP kernel Dt Temporal distance matirx, diagonal 0, diagonal distance elements j time, inputs temporal GP kernel M many neighbors allow spatial NNGP algorithm, defaults 10. nsim long run MCMC total, must greater burn. burn long run MCMC saving samples. thin often save MCMC samples, default 1, saves every iteration. save_ypred Whether output predicted values every iteration print_iter often print iteration number MCMC chain. print_progress Whether print iteration number MCMC chain.","code":""},{"path":"https://kingjms1.github.io/NNGP_ZINB_R/reference/ZINB_NNGP.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Run the ZINB NNGP model described in https://doi.org/10.1016/j.jspi.2023.106098. — ZINB_NNGP","text":"List following sampled values: Alpha, Beta, , B, C, D, Eps1s, Eps2s, Eps1t, Eps2t, L1t, Sigma1t, L2t, Sigma2t, Phi_bin, Sigma1s, Phi_nb, Sigma2s, Sigma_eps1s, Sigma_eps2s, Sigma_eps1t, Sigma_eps2t, R, R2, at_risk, Y_pred save_YPRED = TRUE","code":""}]
